(function(){"use strict";const S=(s,n)=>s===n||!!s&&!!n&&s.length===n.length&&s.every((o,f)=>o.beatmapId===n[f].beatmapId),C=(s,n)=>s&&n&&typeof s=="object"&&typeof n=="object"?Object.keys(s).length===Object.keys(n).length&&Object.keys(s).every(o=>C(s[o],n[o])):s===n,i={mapsPerMode:{}},m=s=>(s.mods&64)===64,g=s=>(s.mods&256)===256,W=s=>({dt:m(s),ht:g(s),ez:(s.mods&2)===2,hd:(s.mods&8)===8,hr:(s.mods&16)===16,fl:(s.mods&1024)===1024}),l=(s,n,o)=>(!s||o>=s)&&(!n||o<=n);function d(s,n){return s!=="yes"&&s!=="no"||s==="yes"&&n||s==="no"&&!n}function M({filters:s,mode:n,mapsPerMode:o}){var A,R;const f=n&&o[n];if(!f||!s||!n)return null;console.log(s);const{songName:u,calcMode:b,count:y,bpmMax:D,bpmMin:E,ppMax:L,ppMin:O,lengthMax:P,lengthMin:q,diffMax:z,diffMin:B,dt:p,hd:v,hr:c,fl:k,languages:w,genres:$,ranked:I,maniaKeys:j}=s;console.time("filter worker task");const r=[];if(u){const e=u==null?void 0:u.toLowerCase().split(" ");r.push(t=>{const a=t.artist?`${t.artist} - ${t.title} [${t.version}] ${t.mapsetId} ${t.beatmapId}`.toLowerCase():`${t.mapsetId} ${t.beatmapId}`;return e.every(h=>a.includes(h))})}if((D||E)&&r.push((e,t)=>{let a=e.bpm;return t.dt&&(a=e.bpm*1.5),t.ht&&(a=e.bpm*.75),l(E,D,a)}),(L||O)&&r.push(e=>!!e.pp&&l(O,L,e.pp)),(P||q)&&r.push(e=>l(q,P,e.length)),(z||B)&&r.push(e=>l(B,z,e.difficulty)),n==="mania"&&j&&j!=="any"&&r.push(e=>j===e.maniaKeys),p&&p!=="any"&&r.push((e,t)=>d(p,t.dt)&&(p!=="invert"||t.ht)),v&&v!=="any"&&r.push((e,t)=>d(v,t.hd)),c&&c!=="any"&&r.push((e,t)=>d(c,t.hr)&&(c!=="invert"||t.ez)),k&&k!=="any"&&r.push((e,t)=>d(k,t.fl)),w&&w.length&&r.push(e=>w.some(t=>t.value===e.language)),$&&$.length&&r.push(e=>$.some(t=>t.value===e.genre)),I&&I.value>0){const e=Date.now()/1e3/60/60;r.push(t=>(e-t.approvedHoursTimestamp)/24<I.value)}const F=r.length?f.filter(e=>{const t=W(e);return r.every(a=>a(e,t))}):f.slice(),[H,G]=(R=(A=s.sorting)==null?void 0:A.value)!=null?R:["farmValue","desc"],K=e=>e.bpm*(m(e)?1.5:g(e)?.75:1),T=e=>e.length*(m(e)?.75:g(e)?1.5:1),V={farmValue:b?(e,t)=>t.farmValues[b]-e.farmValues[b]:null,pp:(e,t)=>{var a,h;return((a=t.pp)!=null?a:0)-((h=e.pp)!=null?h:0)},bpm:(e,t)=>K(t)-K(e),length:(e,t)=>T(t)-T(e),difficulty:(e,t)=>t.difficulty-e.difficulty,hoursSinceRanked:(e,t)=>t.approvedHoursTimestamp-e.approvedHoursTimestamp}[H!=null?H:"farmValue"],J=G==="asc"?-1:1,N=(V?F.sort((e,t)=>V(e,t)*J):F).slice(0,y!=null?y:20);return console.timeEnd("filter worker task"),N}self.onmessage=s=>{const[n,o]=s.data;n==="mode"&&i.mode!==o&&(i.mode=o,self.postMessage(M(i))),n==="maps-mode"&&(S(i.mapsPerMode[o.mode],o.data)||(i.mapsPerMode[o.mode]=o.data,self.postMessage(M(i)))),n==="filters"&&!C(i.filters,o)&&(i.filters=o,self.postMessage(M(i)))}})();
