(function(){"use strict";const L=(e,n)=>e===n||!!e&&!!n&&e.length===n.length&&e.every((o,f)=>o.beatmapId===n[f].beatmapId),$=(e,n)=>e&&n&&typeof e=="object"&&typeof n=="object"?Object.keys(e).length===Object.keys(n).length&&Object.keys(e).every(o=>$(e[o],n[o])):e===n,a={mapsPerMode:{}},A=e=>({ez:(e.mods&2)===2,dt:(e.mods&64)===64,hd:(e.mods&8)===8,hr:(e.mods&16)===16,fl:(e.mods&1024)===1024,ht:(e.mods&256)===256}),l=(e,n,o)=>(!e||o>=e)&&(!n||o<=n);function d(e,n){return e!=="yes"&&e!=="no"||e==="yes"&&n||e==="no"&&!n}function c({filters:e,mode:n,mapsPerMode:o}){const f=n&&o[n];if(!f||!e||!n)return null;console.log(e);const{songName:p,calcMode:m,count:g,bpmMax:I,bpmMin:j,ppMax:E,ppMin:O,lengthMax:P,lengthMin:q,diffMax:z,diffMin:C,dt:u,hd:M,hr:h,fl:b,languages:y,genres:v,ranked:k,maniaKeys:w}=e;console.time("filter worker task");const r=[];if(p){const s=p==null?void 0:p.toLowerCase().split(" ");r.push(t=>{const i=t.artist?`${t.artist} - ${t.title} [${t.version}] ${t.mapsetId} ${t.beatmapId}`.toLowerCase():`${t.mapsetId} ${t.beatmapId}`;return s.every(D=>i.includes(D))})}if((I||j)&&r.push((s,t)=>{let i=s.bpm;return t.dt&&(i=s.bpm*1.5),t.ht&&(i=s.bpm*.75),l(j,I,i)}),(E||O)&&r.push(s=>!!s.pp&&l(O,E,s.pp)),(P||q)&&r.push(s=>l(q,P,s.length)),(z||C)&&r.push(s=>l(C,z,s.difficulty)),n==="mania"&&w&&w!=="any"&&r.push(s=>w===s.maniaKeys),u&&u!=="any"&&r.push((s,t)=>d(u,t.dt)&&(u!=="invert"||t.ht)),M&&M!=="any"&&r.push((s,t)=>d(M,t.hd)),h&&h!=="any"&&r.push((s,t)=>d(h,t.hr)&&(h!=="invert"||t.ez)),b&&b!=="any"&&r.push((s,t)=>d(b,t.fl)),y&&y.length&&r.push(s=>y.some(t=>t.value===s.language)),v&&v.length&&r.push(s=>v.some(t=>t.value===s.genre)),k&&k.value>0){const s=Date.now()/1e3/60/60;r.push(t=>(s-t.approvedHoursTimestamp)/24<k.value)}const K=r.length?f.filter(s=>{const t=A(s);return r.every(i=>i(s,t))}):f.slice(),B=(m?K.sort((s,t)=>t.farmValues[m]-s.farmValues[m]):K).slice(0,g!=null?g:20);return console.timeEnd("filter worker task"),B}self.onmessage=e=>{const[n,o]=e.data;n==="mode"&&a.mode!==o&&(a.mode=o,self.postMessage(c(a))),n==="maps-mode"&&(L(a.mapsPerMode[o.mode],o.data)||(a.mapsPerMode[o.mode]=o.data,self.postMessage(c(a)))),n==="filters"&&!$(a.filters,o)&&(a.filters=o,self.postMessage(c(a)))}})();
