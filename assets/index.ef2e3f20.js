import{m as y}from"./match-sorter.esm.4061cb0b.js";import{u as f,h as A,i as j,k as g,A as M,r as n,b as x,j as s,a as c,s as S,F as R}from"./index.f0d83ab3.js";import{E as b,L as v,u as I,S as k,a as P,b as D,c as Q,d as T}from"./usePersistQuery.c03f362f.js";import{I as V}from"./Input.95d9e974.js";import{M as W,a as _}from"./MapperSubRow.8d29bf86.js";import"./index.e7e5f444.js";import"./Text.c3acffc8.js";const B=e=>{var i;const l=f(),a=A(),{isLoading:r,error:t,data:o}=j(["mapper-maps",l,e,(i=a.data)==null?void 0:i.lastUpdated],()=>g({url:`${M}/data/mappers/${l}/favored-mappers-maps/${e}.json`}));return{isLoading:a.isLoading||r,error:a.error||t,data:o}},J=n.exports.memo(function({mapper:l}){const{data:a,isLoading:r,error:t}=B(l.id),o=n.exports.useMemo(()=>a==null?void 0:a.map(i=>({value:i.count,id:i.id,text:`${i.artist} - ${i.title}`})),[a]);return x(W,{data:o,children:[t instanceof Error&&s(b,{children:t.message}),r&&s(v,{css:{padding:`${c.md} 0`}})]})}),U=()=>{const e=f(),{isLoading:l,error:a,data:r}=I(["fav-mappers",e],()=>g({url:`${M}/data/mappers/${e}/favored-mappers.json`}));return{isLoading:l,error:a,data:n.exports.useMemo(()=>r==null?void 0:r.map((t,o)=>({place:o+1,namesString:t.names.join(" "),id:t.mapperId,value:t.count,names:t.names})),[r])}},X=S("main",{flex:"1 1 auto",display:"flex",flexFlow:"column nowrap",alignItems:"center"}),q=S("div",{padding:c.md,width:"100%"}),h=50;function Z(){const{data:e,isLoading:l,error:a}=U(),[r,t]=n.exports.useState(1),[o,i]=n.exports.useState(""),[u,w]=n.exports.useState(null),E=e?e[0].value:0,d=n.exports.useMemo(()=>{let p=e||[];return o&&e&&(p=y(e,o,{keys:["namesString"],baseSort:(C,L)=>C.index-L.index})),p},[e,o]),F=n.exports.useCallback(({mapper:p})=>s(J,{mapper:p}),[]),$=n.exports.useCallback(()=>{d.length>r&&t(p=>p+h)},[d,r]),m=n.exports.useMemo(()=>d==null?void 0:d.slice(0,r),[r,d]);return n.exports.useEffect(()=>{t(h)},[e,o]),x(X,{children:[a instanceof Error&&s(b,{children:a.message}),l&&s(v,{css:{padding:`${c.md} 0`}}),m&&s(R,{children:x(k,{css:{flex:"1 1 0px",width:"100%",maxWidth:c.tableMaxWidth},children:[s(q,{children:s(V,{placeholder:"search names...",type:"text",onChange:i,value:o})}),s(P,{ref:w,children:m.length?s(_,{mappers:m,scrollParent:u!=null?u:void 0,loadMore:$,maxValue:E,renderExpandedRow:F}):"Didn't find a mapper with this name :("}),s(D,{orientation:"vertical",children:s(Q,{})}),s(T,{})]})})]})}export{Z as default};
