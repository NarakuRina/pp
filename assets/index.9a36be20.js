import{m as y}from"./match-sorter.esm.72456a5e.js";import{u as h,h as A,i as j,k as g,A as M,r as n,b as x,j as s,a as c,s as S,F as R}from"./index.4e4740cf.js";import{E as b,L as v,u as I,S as k,a as P,b as Q,c as T,d as V}from"./usePersistQuery.64b2bc4f.js";import{I as W}from"./Input.9e54eaf2.js";import{M as _,a as B}from"./MapperSubRow.4f1617a6.js";import"./index.6db35dca.js";import"./Text.b99a9da7.js";const D=e=>{var i;const l=h(),a=A(),{isLoading:r,error:t,data:o}=j(["mapper-maps",l,e,(i=a.data)==null?void 0:i.lastUpdated],()=>g({url:`${M}/data/mappers/${l}/favored-mappers-maps/${e}.json`}));return{isLoading:a.isLoading||r,error:a.error||t,data:o}},J=n.exports.memo(function({mapper:l}){const{data:a,isLoading:r,error:t}=D(l.id),o=n.exports.useMemo(()=>a==null?void 0:a.map(i=>({value:i.count,id:i.id,text:`${i.artist} - ${i.title}`})),[a]);return x(_,{data:o,children:[t instanceof Error&&s(b,{children:t.message}),r&&s(v,{css:{padding:`${c.md} 0`}})]})}),U=()=>{const e=h(),{isLoading:l,error:a,data:r}=I(["fav-mappers",e],()=>g({url:`${M}/data/mappers/${e}/favored-mappers.json`}));return{isLoading:l,error:a,data:n.exports.useMemo(()=>r==null?void 0:r.map((t,o)=>({place:o+1,namesString:t.names.join(" "),id:t.mapperId,value:t.count,names:t.names})),[r])}},X=S("main",{flex:"1 1 auto",display:"flex",flexFlow:"column nowrap",alignItems:"center"}),q=S("div",{padding:c.md,width:"100%"}),f=50;function Z(){const{data:e,isLoading:l,error:a}=U(),[r,t]=n.exports.useState(1),[o,i]=n.exports.useState(""),[u,w]=n.exports.useState(null),E=e?e[0].value:0,d=n.exports.useMemo(()=>{let p=e||[];return o&&e&&(p=y(e,o,{keys:["namesString"],baseSort:(C,L)=>C.index-L.index})),p},[e,o]),F=n.exports.useCallback(({mapper:p})=>s(J,{mapper:p}),[]),$=n.exports.useCallback(()=>{d.length>r&&t(p=>p+f)},[d,r]),m=n.exports.useMemo(()=>d==null?void 0:d.slice(0,r),[r,d]);return n.exports.useEffect(()=>{t(f)},[e,o]),x(X,{children:[a instanceof Error&&s(b,{children:a.message}),l&&s(v,{css:{padding:`${c.md} 0`}}),m&&!!m.length&&s(R,{children:x(k,{css:{flex:"1 1 0px",width:"100%",maxWidth:c.tableMaxWidth},children:[s(q,{children:s(W,{placeholder:"search names...",type:"text",onChange:i,value:o})}),s(P,{ref:w,children:s(B,{mappers:m,scrollParent:u!=null?u:void 0,loadMore:$,maxValue:E,renderExpandedRow:F})}),s(Q,{orientation:"vertical",children:s(T,{})}),s(V,{})]})})]})}export{Z as default};
