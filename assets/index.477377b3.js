import{m as L}from"./match-sorter.esm.a5b3b4ba.js";import{u as f,h as y,i as A,k as g,A as M,r as n,b as x,l as j,j as s,a as c,s as S,F as R}from"./index.facc8775.js";import{E as b,L as v,u as I,S as k,a as P,b as U,c as D,d as Q}from"./usePersistQuery.78f04b7c.js";import{I as T}from"./Input.adb70025.js";import{M as V,a as W}from"./MapperSubRow.7323fb42.js";import"./index.4c9d939b.js";import"./Text.4cd1cf4f.js";const _=e=>{var i;const l=f(),a=y(),{isLoading:r,error:t,data:o}=A(["mapper-maps",l,e,(i=a.data)==null?void 0:i.lastUpdated],()=>g({url:`${M}/data/mappers/${l}/favored-mappers-maps/${e}.json`}));return{isLoading:a.isLoading||r,error:a.error||t,data:o}},B=n.exports.memo(function({mapper:l}){const{data:a,isLoading:r,error:t}=_(l.id),o=n.exports.useMemo(()=>a==null?void 0:a.map(i=>({value:i.count,id:i.id,text:`${i.artist} - ${i.title}`})),[a]);return x(V,{data:o,getUrl:j,children:[t instanceof Error&&s(b,{children:t.message}),r&&s(v,{css:{padding:`${c.md} 0`}})]})}),J=()=>{const e=f(),{isLoading:l,error:a,data:r}=I(["fav-mappers",e],()=>g({url:`${M}/data/mappers/${e}/favored-mappers.json`}));return{isLoading:l,error:a,data:n.exports.useMemo(()=>r==null?void 0:r.map((t,o)=>({place:o+1,namesString:t.names.join(" "),id:t.mapperId,value:t.count,names:t.names})),[r])}},X=S("main",{flex:"1 1 auto",display:"flex",flexFlow:"column nowrap",alignItems:"center"}),q=S("div",{padding:c.md,width:c.tableMaxWidth,maxWidth:"100%",margin:"0 auto"}),h=50;function Z(){const{data:e,isLoading:l,error:a}=J(),[r,t]=n.exports.useState(1),[o,i]=n.exports.useState(""),[u,w]=n.exports.useState(null),E=e?e[0].value:0,p=n.exports.useMemo(()=>o&&e?L(e,o,{keys:["namesString"],baseSort:(d,C)=>d.index-C.index}):e,[e,o]),F=n.exports.useCallback(({mapper:d})=>s(B,{mapper:d}),[]),$=n.exports.useCallback(()=>{p&&p.length>r&&t(d=>d+h)},[p,r]),m=n.exports.useMemo(()=>p==null?void 0:p.slice(0,r),[r,p]);return n.exports.useEffect(()=>{t(h)},[e,o]),x(X,{children:[a instanceof Error&&s(b,{children:a.message}),l&&s(v,{css:{padding:`${c.md} 0`}}),m&&s(R,{children:x(k,{css:{flex:"1 1 0px"},children:[s(q,{children:s(T,{placeholder:"search names...",type:"text",onChange:i,value:o})}),s(P,{ref:w,children:m.length?s(W,{mappers:m,scrollParent:u!=null?u:void 0,loadMore:$,maxValue:E,renderExpandedRow:F}):"Didn't find a mapper with this name :("}),s(U,{orientation:"vertical",children:s(D,{})}),s(Q,{})]})})]})}export{Z as default};
