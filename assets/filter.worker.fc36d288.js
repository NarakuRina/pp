(function(){"use strict";const A=(e,n)=>e===n||!!e&&!!n&&e.length===n.length&&e.every((r,f)=>r.beatmapId===n[f].beatmapId),$=(e,n)=>e&&n&&typeof e=="object"&&typeof n=="object"?Object.keys(e).length===Object.keys(n).length&&Object.keys(e).every(r=>$(e[r],n[r])):e===n,a={mapsPerMode:{}},B=e=>({dt:(e.mods&64)===64,hd:(e.mods&8)===8,hr:(e.mods&16)===16,fl:(e.mods&1024)===1024,ht:(e.mods&256)===256}),l=(e,n,r)=>(!e||r>=e)&&(!n||r<=n);function d(e,n){return e!=="yes"&&e!=="no"||e==="yes"&&n||e==="no"&&!n}function h({filters:e,mode:n,mapsPerMode:r}){const f=n&&r[n];if(!f||!e||!n)return null;const{songName:p,calcMode:c,count:m,bpmMax:I,bpmMin:j,ppMax:E,ppMin:O,lengthMax:P,lengthMin:q,diffMax:C,diffMin:K,dt:u,hd:g,hr:M,fl:b,languages:y,genres:v,ranked:k,maniaKeys:w}=e;console.time("filter worker task");const o=[];if(p){const s=p==null?void 0:p.toLowerCase().split(" ");o.push(t=>{const i=t.artist?`${t.artist} - ${t.title} [${t.version}] ${t.mapsetId} ${t.beatmapId}`.toLowerCase():`${t.mapsetId} ${t.beatmapId}`;return s.every(F=>i.includes(F))})}if((I||j)&&o.push((s,t)=>{let i=s.bpm;return t.dt&&(i=s.bpm*1.5),t.ht&&(i=s.bpm*.75),l(j,I,i)}),(E||O)&&o.push(s=>!!s.pp&&l(O,E,s.pp)),(P||q)&&o.push(s=>l(q,P,s.length)),(C||K)&&o.push(s=>l(K,C,s.difficulty)),n==="mania"&&w&&w!=="any"&&o.push(s=>w===s.maniaKeys),u&&u!=="any"&&o.push((s,t)=>d(u,t.dt)&&(u!=="invert"||t.ht)),g&&g!=="any"&&o.push((s,t)=>d(g,t.hd)),M&&M!=="any"&&o.push((s,t)=>d(M,t.hr)),b&&b!=="any"&&o.push((s,t)=>d(b,t.fl)),y&&y.length&&o.push(s=>y.some(t=>t.value===s.language)),v&&v.length&&o.push(s=>v.some(t=>t.value===s.genre)),k&&k.value>0){const s=Date.now()/1e3/60/60;o.push(t=>(s-t.approvedHoursTimestamp)/24<k.value)}const L=o.length?f.filter(s=>{const t=B(s);return o.every(i=>i(s,t))}):f.slice(),D=(c?L.sort((s,t)=>t.farmValues[c]-s.farmValues[c]):L).slice(0,m!=null?m:20);return console.timeEnd("filter worker task"),D}self.onmessage=e=>{const[n,r]=e.data;n==="mode"&&a.mode!==r&&(a.mode=r,self.postMessage(h(a))),n==="maps-mode"&&(A(a.mapsPerMode[r.mode],r.data)||(a.mapsPerMode[r.mode]=r.data,self.postMessage(h(a)))),n==="filters"&&!$(a.filters,r)&&(a.filters=r,self.postMessage(h(a)))}})();
