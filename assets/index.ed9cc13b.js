import{L as v,E as S,F,u as I,P as L,S as A}from"./usePersistQuery.39d4abdc.js";import{s as l,c as w,b as s,j as e,u as C,h as B,i as P,k as E,A as D,a5 as N,E as R,t as $,a as i,r as g,F as O,o as W,f as j,Q as y,a6 as z,a7 as U,a4 as Q}from"./index.84df026b.js";import{m as H}from"./match-sorter.esm.9d33b0d6.js";import{I as T}from"./Input.49ef4a8d.js";import{T as _}from"./index.90e28277.js";import{T as h}from"./Text.4ae84da6.js";const G=l("span",{display:"flex",alignItems:"center",variants:{type:{zero:{color:w.textBlue},negative:{color:w.textRed},positive:{color:w.textGreen}}}}),J=l("span",{width:"0.8rem",fontSize:"80%",variants:{small:{true:{fontSize:"60%"}}}}),X=({delta:t})=>s(G,{type:t===0?"zero":t>0?"positive":"negative",children:[e(J,{small:Math.abs(t)<8,children:t===0?"\u25A0":t>0?"\u25B2":"\u25BC"}),Math.abs(t)]}),q=t=>{var p;const o=C(),a=B(),{isLoading:d,error:n,data:c}=P(["scores",o,t,(p=a.data)==null?void 0:p.lastUpdated],()=>E({url:`${D}/data/ranking/${o}/player-scores/${t}.json`}));return{isLoading:a.isLoading||d,error:a.error||n,data:c}},K=l("div",{whiteSpace:"normal"}),V=({item:t})=>{const{data:o,error:a,isLoading:d}=q(t.id);return e(K,{children:d?e(v,{}):a instanceof Error?e(S,{children:a.message}):o?s("table",{style:{width:"100%",borderSpacing:"0.5em"},children:[e("thead",{children:s("tr",{children:[s("td",{children:["updated ",e(_,{date:new Date(t.minuteUpdated*60*1e3)})]}),e("td",{children:e(h,{nowrap:!0,children:"original pp"})}),e("td",{children:e(h,{nowrap:!0,children:"adjusted"})}),e("td",{children:e(h,{nowrap:!0,children:"weighted"})})]})}),e("tbody",{children:o.map((n,c)=>{const p=N(n.mods);return s("tr",{children:[s("td",{children:[e(R,{url:$(n.beatmapId),children:n.title}),p&&" +"+p]}),e("td",{children:s(h,{nowrap:!0,children:[e(h,{faded:!0,children:n.ppOld})," ",s(h,{color:n.ppNew>=n.ppOld?"green":"red",children:[n.ppNew>=n.ppOld?"+":"",n.ppNew-n.ppOld," ="]})]})}),s("td",{children:[e(h,{nowrap:!0,bold:!0,children:n.ppNew}),e(h,{faded:!0,children:"pp"})]}),e("td",{children:s(h,{faded:!0,nowrap:!0,children:[Math.round(n.ppNew*Math.pow(.95,c))," (",Math.round(Math.pow(.95,c)*100),"%)"]})})]},`${n.beatmapId}_${n.mods}`)})})]}):e(S,{children:"Data not found"})})},Y=l(F,{marginRight:i.sm}),M=l("tr",{background:w.bgElement,borderRadius:i.sm,"& > td:first-child":{borderTopLeftRadius:i.sm,borderBottomLeftRadius:i.sm},"& > td:last-child":{borderTopRightRadius:i.sm,borderBottomRightRadius:i.sm}}),m=l("td",{whiteSpace:"nowrap",padding:`${i.xs} ${i.md}`}),Z=({item:t})=>{const[o,a]=g.exports.useState(!1);return s(O,{children:[s(M,{children:[s(m,{css:{width:"4.8em"},children:["#",t.place]}),e(m,{css:{width:"4.8em"},children:e(X,{delta:t.placeOld-t.place})}),e(m,{css:{width:"55%"},children:e(R,{url:W(t.id),children:t.name})}),e(m,{css:{textAlign:"center",fontWeight:"bold"},children:Math.round(t.ppNew)}),e(m,{css:{textAlign:"right",width:"1em",fontSize:j[75],padding:i.xs},children:s(y,{color:"indigo",onClick:()=>a(d=>!d),children:[e(Y,{flipped:o})," scores"]})})]}),o&&e(M,{children:e(m,{colSpan:5,children:e(V,{item:t})})})]})},b=20,ee=l("div",{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}),te=l("table",{maxWidth:i.tableMaxWidth,width:"100%",borderSpacing:`0 ${i.xs}`,borderCollapse:"separate"}),x=l("th",{whiteSpace:"nowrap"}),re=l(T,{fontWeight:"normal",maxWidth:"20em",width:"95%"}),ne=l("div",{display:"flex",alignItems:"center",gap:i.xs,"& > input":{width:"2em"}}),ae=({rankings:t})=>{const[o,a]=g.exports.useState(1),[d,n]=g.exports.useState(""),c=g.exports.useMemo(()=>t.sort((r,u)=>u.ppOld-r.ppOld).map((r,u)=>({...r,placeOld:u+1})).sort((r,u)=>u.ppNew-r.ppNew).map((r,u)=>({...r,place:u+1})),[t]),{data:p,pagesCount:f}=g.exports.useMemo(()=>{let r=c;return d&&(r=H(c,d,{keys:["name"]})),{data:r.slice((o-1)*b,o*b),pagesCount:Math.ceil(r.length/b)}},[c,o,d]),k=g.exports.useCallback(r=>{n(r),a(1)},[]);return e(ee,{children:s(te,{children:[e("thead",{children:s("tr",{children:[e(x,{colSpan:2,children:s(ne,{children:[e(y,{color:"sand",iconButton:!0,onClick:()=>a(r=>Math.max(1,r-1)),children:e(z,{})}),e(T,{withHighlight:!1,type:"number",value:o,onChange:r=>a(Math.min(f,Math.max(1,r!=null?r:1)))}),e(y,{color:"sand",iconButton:!0,onClick:()=>a(r=>Math.min(f,r+1)),children:e(U,{})})]})}),e(x,{css:{textAlign:"left"},children:e(re,{placeholder:"search names...",type:"text",onChange:k,value:d})}),e(x,{children:"pp"}),e(x,{})]})}),s("tbody",{children:[p.length===0&&d?e("tr",{children:e("td",{style:{textAlign:"center"},colSpan:5,children:"Didn't find a user with this name :("})}):null,p.map(r=>e(Z,{item:r},r.id))]})]})})},se=()=>{const t=C(),[o,a]=g.exports.useState(null),d=async f=>await Q({path:`data/ranking/${f}/players.csv`,setProgress:a}),{isLoading:n,error:c,data:p}=I(["rankings",t],()=>(a(null),d(t)));return{isLoading:n,error:c,data:p,progress:o}},oe=l("main",{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap","& > footer":{display:"flex",alignItems:"center",justifyContent:"center",padding:i.sm}});function ue(){const{isLoading:t,error:o,data:a,progress:d}=se();return s(oe,{children:[o instanceof Error&&e(S,{children:o.message}),e("header",{children:t&&d!==null&&e(L,{css:{margin:"0 auto"},progress:d})}),e(A,{css:{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap",alignItems:"center"},children:a&&e(ae,{rankings:a})})]})}export{ue as default};
