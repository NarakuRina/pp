import{L as T,E as S,F as v,u as F,P as I,S as L,a as B,b as P,c as E,d as D}from"./usePersistQuery.8ef62d90.js";import{s as l,c as w,b as a,j as e,u as M,h as N,i as $,k as O,A as W,a4 as j,E as R,z,a as d,r as g,F as U,x as Q,f as H,Q as y,a5 as _,a6 as G,a3 as J}from"./index.77e41bb5.js";import{m as V}from"./match-sorter.esm.75ed97ee.js";import{I as A}from"./Input.94454b7d.js";import{T as X}from"./index.aa34769f.js";import{T as h}from"./Text.4b203bac.js";const q=l("span",{display:"flex",alignItems:"center",variants:{type:{zero:{color:w.textBlue},negative:{color:w.textRed},positive:{color:w.textGreen}}}}),K=l("span",{width:"0.8rem",fontSize:"80%",variants:{small:{true:{fontSize:"60%"}}}}),Y=({delta:t})=>a(q,{type:t===0?"zero":t>0?"positive":"negative",children:[e(K,{small:Math.abs(t)<8,children:t===0?"\u25A0":t>0?"\u25B2":"\u25BC"}),Math.abs(t)]}),Z=t=>{var p;const o=M(),s=N(),{isLoading:i,error:n,data:c}=$(["scores",o,t,(p=s.data)==null?void 0:p.lastUpdated],()=>O({url:`${W}/data/ranking/${o}/player-scores/${t}.json`}));return{isLoading:s.isLoading||i,error:s.error||n,data:c}},ee=l("div",{whiteSpace:"normal"}),te=({item:t})=>{const{data:o,error:s,isLoading:i}=Z(t.id);return e(ee,{children:i?e(T,{}):s instanceof Error?e(S,{children:s.message}):o?a("table",{style:{width:"100%",borderSpacing:"0.5em"},children:[e("thead",{children:a("tr",{children:[a("td",{children:["updated ",e(X,{date:new Date(t.minuteUpdated*60*1e3)})]}),e("td",{children:e(h,{nowrap:!0,children:"original pp"})}),e("td",{children:e(h,{nowrap:!0,children:"adjusted"})}),e("td",{children:e(h,{nowrap:!0,children:"weighted"})})]})}),e("tbody",{children:o.map((n,c)=>{const p=j(n.mods);return a("tr",{children:[a("td",{children:[e(R,{url:z(n.beatmapId),children:n.title}),p&&" +"+p]}),e("td",{children:a(h,{nowrap:!0,children:[e(h,{faded:!0,children:n.ppOld})," ",a(h,{color:n.ppNew>=n.ppOld?"green":"red",children:[n.ppNew>=n.ppOld?"+":"",n.ppNew-n.ppOld," ="]})]})}),a("td",{children:[e(h,{nowrap:!0,bold:!0,children:n.ppNew}),e(h,{faded:!0,children:"pp"})]}),e("td",{children:a(h,{faded:!0,nowrap:!0,children:[Math.round(n.ppNew*Math.pow(.95,c))," (",Math.round(Math.pow(.95,c)*100),"%)"]})})]},`${n.beatmapId}_${n.mods}`)})})]}):e(S,{children:"Data not found"})})},re=l(v,{marginRight:d.sm}),C=l("tr",{background:w.bgElement,borderRadius:d.sm,"& > td:first-child":{borderTopLeftRadius:d.sm,borderBottomLeftRadius:d.sm},"& > td:last-child":{borderTopRightRadius:d.sm,borderBottomRightRadius:d.sm}}),m=l("td",{whiteSpace:"nowrap",padding:`${d.xs} ${d.md}`}),ne=({item:t})=>{const[o,s]=g.exports.useState(!1);return a(U,{children:[a(C,{children:[a(m,{css:{width:"4.8em"},children:["#",t.place]}),e(m,{css:{width:"4.8em"},children:e(Y,{delta:t.placeOld-t.place})}),e(m,{css:{width:"55%"},children:e(R,{url:Q(t.id),children:t.name})}),e(m,{css:{textAlign:"center",fontWeight:"bold"},children:Math.round(t.ppNew)}),e(m,{css:{textAlign:"right",width:"1em",fontSize:H[75],padding:d.xs},children:a(y,{color:"indigo",onClick:()=>s(i=>!i),children:[e(re,{flipped:o})," scores"]})})]}),o&&e(C,{children:e(m,{colSpan:5,children:e(te,{item:t})})})]})},b=20,ae=l("div",{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}),se=l("table",{maxWidth:d.tableMaxWidth,width:"100%",borderSpacing:`0 ${d.xs}`,borderCollapse:"separate"}),x=l("th",{whiteSpace:"nowrap"}),oe=l(A,{fontWeight:"normal",maxWidth:"20em",width:"95%"}),ie=l("div",{display:"flex",alignItems:"center",gap:d.xs,"& > input":{width:"2em"}}),de=({rankings:t})=>{const[o,s]=g.exports.useState(1),[i,n]=g.exports.useState(""),c=g.exports.useMemo(()=>t.sort((r,u)=>u.ppOld-r.ppOld).map((r,u)=>({...r,placeOld:u+1})).sort((r,u)=>u.ppNew-r.ppNew).map((r,u)=>({...r,place:u+1})),[t]),{data:p,pagesCount:f}=g.exports.useMemo(()=>{let r=c;return i&&(r=V(c,i,{keys:["name"]})),{data:r.slice((o-1)*b,o*b),pagesCount:Math.ceil(r.length/b)}},[c,o,i]),k=g.exports.useCallback(r=>{n(r),s(1)},[]);return e(ae,{children:a(se,{children:[e("thead",{children:a("tr",{children:[e(x,{colSpan:2,children:a(ie,{children:[e(y,{color:"sand",iconButton:!0,onClick:()=>s(r=>Math.max(1,r-1)),children:e(_,{})}),e(A,{withHighlight:!1,type:"number",value:o,onChange:r=>s(Math.min(f,Math.max(1,r!=null?r:1)))}),e(y,{color:"sand",iconButton:!0,onClick:()=>s(r=>Math.min(f,r+1)),children:e(G,{})})]})}),e(x,{css:{textAlign:"left"},children:e(oe,{placeholder:"search names...",type:"text",onChange:k,value:i})}),e(x,{children:"pp"}),e(x,{})]})}),a("tbody",{children:[p.length===0&&i?e("tr",{children:e("td",{style:{textAlign:"center"},colSpan:5,children:"Didn't find a user with this name :("})}):null,p.map(r=>e(ne,{item:r},r.id))]})]})})},le=()=>{const t=M(),[o,s]=g.exports.useState(null),i=async f=>await J({path:`data/ranking/${f}/players.csv`,setProgress:s}),{isLoading:n,error:c,data:p}=F(["rankings",t],()=>(s(null),i(t)));return{isLoading:n,error:c,data:p,progress:o}},ce=l("main",{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap","& > footer":{display:"flex",alignItems:"center",justifyContent:"center",padding:d.sm}});function xe(){const{isLoading:t,error:o,data:s,progress:i}=le();return a(ce,{children:[o instanceof Error&&e(S,{children:o.message}),e("header",{children:t&&i!==null&&e(I,{css:{margin:"0 auto"},progress:i})}),a(L,{css:{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap",alignItems:"center"},children:[e(B,{children:s&&e(de,{rankings:s})}),e(P,{orientation:"vertical",children:e(E,{})}),e(D,{})]})]})}export{xe as default};
