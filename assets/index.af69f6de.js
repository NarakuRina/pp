import{L as T,E as S,F as v,u as F,P as I,S as L,a as P,b as $,c as B,d as E}from"./usePersistQuery.c03f362f.js";import{s as l,c as x,b as a,j as e,u as M,h as D,i as N,k as O,A as W,a1 as j,E as R,a as d,r as m,F as z,f as H,K as y,a2 as Q,a3 as U,a0 as _}from"./index.f0d83ab3.js";import{m as G}from"./match-sorter.esm.4061cb0b.js";import{I as A}from"./Input.95d9e974.js";import{T as J}from"./index.4fab6d3e.js";import{T as h}from"./Text.c3acffc8.js";const K=l("span",{display:"flex",alignItems:"center",variants:{type:{zero:{color:x.textBlue},negative:{color:x.textRed},positive:{color:x.textGreen}}}}),V=l("span",{width:"0.8rem",fontSize:"80%",variants:{small:{true:{fontSize:"60%"}}}}),X=({delta:t})=>a(K,{type:t===0?"zero":t>0?"positive":"negative",children:[e(V,{small:Math.abs(t)<8,children:t===0?"\u25A0":t>0?"\u25B2":"\u25BC"}),Math.abs(t)]}),q=t=>{var p;const o=M(),s=D(),{isLoading:i,error:n,data:c}=N(["scores",o,t,(p=s.data)==null?void 0:p.lastUpdated],()=>O({url:`${W}/data/ranking/${o}/player-scores/${t}.json`}));return{isLoading:s.isLoading||i,error:s.error||n,data:c}},Y=l("div",{whiteSpace:"normal"}),Z=({item:t})=>{const{data:o,error:s,isLoading:i}=q(t.id);return e(Y,{children:i?e(T,{}):s instanceof Error?e(S,{children:s.message}):o?a("table",{style:{width:"100%",borderSpacing:"0.5em"},children:[e("thead",{children:a("tr",{children:[a("td",{children:["updated ",e(J,{date:new Date(t.minuteUpdated*60*1e3)})]}),e("td",{children:e(h,{nowrap:!0,children:"original pp"})}),e("td",{children:e(h,{nowrap:!0,children:"adjusted"})}),e("td",{children:e(h,{nowrap:!0,children:"weighted"})})]})}),e("tbody",{children:o.map((n,c)=>{const p=j(n.mods);return a("tr",{children:[a("td",{children:[e(R,{url:`http://osu.ppy.sh/b/${n.beatmapId}`,children:n.title}),p&&" +"+p]}),e("td",{children:a(h,{nowrap:!0,children:[e(h,{faded:!0,children:n.ppOld})," ",a(h,{color:n.ppNew>=n.ppOld?"green":"red",children:[n.ppNew>=n.ppOld?"+":"",n.ppNew-n.ppOld," ="]})]})}),a("td",{children:[e(h,{nowrap:!0,bold:!0,children:n.ppNew}),e(h,{faded:!0,children:"pp"})]}),e("td",{children:a(h,{faded:!0,nowrap:!0,children:[Math.round(n.ppNew*Math.pow(.95,c))," (",Math.round(Math.pow(.95,c)*100),"%)"]})})]},`${n.beatmapId}_${n.mods}`)})})]}):e(S,{children:"Data not found"})})},ee=l(v,{marginRight:d.sm}),C=l("tr",{background:x.bgElement,borderRadius:d.sm,"& > td:first-child":{borderTopLeftRadius:d.sm,borderBottomLeftRadius:d.sm},"& > td:last-child":{borderTopRightRadius:d.sm,borderBottomRightRadius:d.sm}}),g=l("td",{whiteSpace:"nowrap",padding:`${d.xs} ${d.md}`}),te=({item:t})=>{const[o,s]=m.exports.useState(!1);return a(z,{children:[a(C,{children:[a(g,{css:{width:"4.8em"},children:["#",t.place]}),e(g,{css:{width:"4.8em"},children:e(X,{delta:t.placeOld-t.place})}),e(g,{css:{width:"55%"},children:e(R,{url:`https://osu.ppy.sh/users/${t.id}`,children:t.name})}),e(g,{css:{textAlign:"center",fontWeight:"bold"},children:Math.round(t.ppNew)}),e(g,{css:{textAlign:"right",width:"1em",fontSize:H[75],padding:d.xs},children:a(y,{color:"indigo",onClick:()=>s(i=>!i),children:[e(ee,{flipped:o})," scores"]})})]}),o&&e(C,{children:e(g,{colSpan:5,children:e(Z,{item:t})})})]})},b=20,re=l("div",{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}),ne=l("table",{maxWidth:d.tableMaxWidth,width:"100%",borderSpacing:`0 ${d.xs}`,borderCollapse:"separate"}),w=l("th",{whiteSpace:"nowrap"}),ae=l(A,{fontWeight:"normal",maxWidth:"20em",width:"95%"}),se=l("div",{display:"flex",alignItems:"center",gap:d.xs,"& > input":{width:"2em"}}),oe=({rankings:t})=>{const[o,s]=m.exports.useState(1),[i,n]=m.exports.useState(""),c=m.exports.useMemo(()=>t.sort((r,u)=>u.ppOld-r.ppOld).map((r,u)=>({...r,placeOld:u+1})).sort((r,u)=>u.ppNew-r.ppNew).map((r,u)=>({...r,place:u+1})),[t]),{data:p,pagesCount:f}=m.exports.useMemo(()=>{let r=c;return i&&(r=G(c,i,{keys:["name"]})),{data:r.slice((o-1)*b,o*b),pagesCount:Math.ceil(r.length/b)}},[c,o,i]),k=m.exports.useCallback(r=>{n(r),s(1)},[]);return e(re,{children:a(ne,{children:[e("thead",{children:a("tr",{children:[e(w,{colSpan:2,children:a(se,{children:[e(y,{color:"sand",iconButton:!0,onClick:()=>s(r=>Math.max(1,r-1)),children:e(Q,{})}),e(A,{withHighlight:!1,type:"number",value:o,onChange:r=>s(Math.min(f,Math.max(1,r!=null?r:1)))}),e(y,{color:"sand",iconButton:!0,onClick:()=>s(r=>Math.min(f,r+1)),children:e(U,{})})]})}),e(w,{css:{textAlign:"left"},children:e(ae,{placeholder:"search names...",type:"text",onChange:k,value:i})}),e(w,{children:"pp"}),e(w,{})]})}),a("tbody",{children:[p.length===0&&i?e("tr",{children:e("td",{style:{textAlign:"center"},colSpan:5,children:"Didn't find a user with this name :("})}):null,p.map(r=>e(te,{item:r},r.id))]})]})})},ie=()=>{const t=M(),[o,s]=m.exports.useState(null),i=async f=>await _({path:`data/ranking/${f}/players.csv`,setProgress:s}),{isLoading:n,error:c,data:p}=F(["rankings",t],()=>(s(null),i(t)));return{isLoading:n,error:c,data:p,progress:o}},de=l("main",{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap","& > footer":{display:"flex",alignItems:"center",justifyContent:"center",padding:d.sm}});function ge(){const{isLoading:t,error:o,data:s,progress:i}=ie();return a(de,{children:[o instanceof Error&&e(S,{children:o.message}),e("header",{children:t&&i!==null&&e(I,{progress:i})}),a(L,{css:{flex:"1 1 0px",display:"flex",flexFlow:"column nowrap",alignItems:"center"},children:[e(P,{children:s&&e(oe,{rankings:s})}),e($,{orientation:"vertical",children:e(B,{})}),e(E,{})]})]})}export{ge as default};
